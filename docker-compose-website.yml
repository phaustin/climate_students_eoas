version: '3'

#
# generated by https://github.com/phaustin/climate_students_eoas/blob/student_branch/ansible/templates/docker-compose-website_noauth.j2
# vars/website_climate_students.yml
#

services:

  climate_2022:
    image: httpd:2.4.51
    container_name: climate_2022_apache
    volumes:
      - ~/repos/climate_students_eoas/book_html_source/:/usr/local/apache2/htdocs:ro
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - traefik.enable=true
      - "traefik.http.routers.climate_2022.rule=Host(`phaustin.org`) && PathPrefix(`/climate_2022`)"
      - "traefik.http.routers.climate_2022.middlewares=climate_2022_chain"
      - "traefik.http.middlewares.climate_2022-stripprefix.stripprefix.prefixes=/climate_2022"
      - "traefik.http.middlewares.climate_2022_chain.chain.middlewares=strip-prefix-start@file,strip-prefix-end@file,climate_2022-stripprefix"
      - traefik.http.routers.climate_2022.tls=true
      - traefik.http.routers.climate_2022.tls.certresolver=lets-encrypt
      - traefik.http.routers.climate_2022.service=climate_2022
      - traefik.http.services.climate_2022.loadbalancer.server.port=80
    restart: on-failure
    networks:
      - traefik_net


networks:
    traefik_net:
      external: true
